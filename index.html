
<html>
  <head>
    <title>Viewable Time Tracker</title>
    <style>
      #div-gpt-div-1 {
        height: 250px;
        width:300px;
        background-color: #f080f0;
        margin-bottom: 50px;
      }

      #div-gpt-div-2 {
        height: 250px;
        width:300px;
        background-color: #90d0d0;
      }
    </style>
    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
<script>
  window.googletag = window.googletag || {cmd: []};
   var slot1;
  googletag.cmd.push(function() {
   slot1 = googletag.defineSlot('/200894144/Responsive', [[300, 250], [300, 600]], 'div-gpt-ad-1620832289302-0').setTargeting("Test_Mode", "ON").addService(googletag.pubads());
    
        googletag.enableServices();
  });
</script>
  </head>
  <body>
    <div id="div-gpt-div-1"></div>
    <div id="div-gpt-div-2"></div>
    <div id='div-gpt-ad-1620832289302-0'>
<script>
googletag.cmd.push(function() { googletag.display('div-gpt-ad-1620832289302-0');
//setInterval(function(){googletag.pubads().refresh([slot1]);}, 3000);
});
</script>
</div>

    <script>
      var divs = document.querySelectorAll('div[id^="div-gpt"]');
      var timers = {};

      function isInView(elem) {
        var bounding = elem.getBoundingClientRect();
        return (
          bounding.top >= 0 &&
          bounding.left >= 0 &&
          bounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
          bounding.right <= (window.innerWidth || document.documentElement.clientWidth)
        );
      }

      function startViewTimer(id) {
        timers[id] = {
          viewTime: 0,
          intervalID: setInterval(function() {
            if (isInView(document.getElementById(id))) {
              timers[id].viewTime += 1;
              console.log('Viewable time for ' + id + ':', timers[id].viewTime, 'seconds');
              if (timers[id].viewTime == 10) {
                alert('You have viewed the ' + id + ' div for 10 seconds!');
                googletag.pubads().refresh([slot1]);
              }
            } else {
              timers[id].viewTime = 0;
            }
          }, 1000)
        };
      }

      function stopViewTimer(id) {
        clearInterval(timers[id].intervalID);
        delete timers[id];
      }

      for (var i = 0; i < divs.length; i++) {
        var div = divs[i];
        var id = div.getAttribute('id');
        startViewTimer(id);
      }

      document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'hidden') {
          for (var id in timers) {
            stopViewTimer(id);
          }
        } else {
          for (var i = 0; i < divs.length; i++) {
            var div = divs[i];
            var id = div.getAttribute('id');
            if (timers[id]) {
              clearInterval(timers[id].intervalID);
              timers[id].viewTime = 0;
            }
            startViewTimer(id);
          }
        }
      });
    </script>
  </body>
</html>
